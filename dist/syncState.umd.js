!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.reduxStateSync=t():e.reduxStateSync=t()}(window,(function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initMessageListener=t.initStateWithPrevTab=t.withReduxStateSync=t.createReduxStateSync=t.createStateSyncMiddleware=void 0,t.generateUuidForAction=l,t.isActionAllowed=f,t.isActionSynced=function(e){return!!e.$isSync},t.MessageListener=p;var a,r=n(1),i=(a=r)&&a.__esModule?a:{default:a};var s=0,o={channel:"redux_state_sync",predicate:null,blacklist:[],whitelist:[],broadcastChannelOption:void 0,prepareState:function(e){return e}};function u(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function c(){return""+u()+u()+"-"+u()+"-"+u()+"-"+u()+"-"+u()+u()+u()}var d=c();function l(e){var t=e;return t.$uuid=c(),t.$wuid=d,t}function f(e){var t=e.predicate,n=e.blacklist,a=e.whitelist,r=function(){return!0};return t&&"function"==typeof t?r=t:Array.isArray(n)?r=function(e){return n.indexOf(e.type)<0}:Array.isArray(a)&&(r=function(e){return a.indexOf(e.type)>=0}),r}function p(e){var t=e.channel,n=e.dispatch,a=e.allowed,r=!1,i={};this.handleOnMessage=function(e){e.$wuid!==d&&("&_RECEIVE_INIT_STATE"!==e.type&&e.$uuid&&e.$uuid!==s&&("&_GET_INIT_STATE"!==e.type||i[e.$wuid]?"&_SEND_INIT_STATE"!==e.type||i[e.$wuid]?a(e)&&(s=e.$uuid,n(Object.assign(e,{$isSync:!0}))):r||(r=!0,n({type:"&_RECEIVE_INIT_STATE",payload:e.payload})):(i[e.$wuid]=!0,n({type:"&_SEND_INIT_STATE"}))))},this.messageChannel=t,this.messageChannel.onmessage=this.handleOnMessage}t.createStateSyncMiddleware=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=f(e),n=new i.default(e.channel),a=e.prepareState||o.prepareState,r=null;return function(e){var i=e.getState,o=e.dispatch;return function(e){return function(u){if(r||(r=new p({channel:n,dispatch:o,allowed:t})),u&&!u.$uuid){var c=l(u);s=c.$uuid;try{if("&_SEND_INIT_STATE"===u.type)return i()&&(c.payload=a(i()),n.postMessage(c)),e(u);(t(c)||"&_GET_INIT_STATE"===u.type)&&n.postMessage(c)}catch(e){console.error("Your browser doesn't support cross tab communication")}}return e(Object.assign(u,{$isSync:void 0!==u.$isSync&&u.$isSync}))}}}};var h=t.createReduxStateSync=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.prepareState;return function(n,a){var r=n;return"&_RECEIVE_INIT_STATE"===a.type&&(r=t(a.payload)),e(r,a)}};t.withReduxStateSync=h,t.initStateWithPrevTab=function(e){(0,e.dispatch)({type:"&_GET_INIT_STATE"})},t.initMessageListener=function(e){(0,e.dispatch)({type:"&_INIT_MESSAGE_LISTENER"})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var r=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isTop="undefined"==typeof window||window===window.parent,this.name=t,this.handlers={message:[],messageerror:[]},this.onMessage=null,this.mainHandler={message:function(e){"frame-broadcast"===e.data.type&&e.data.channel===n.name&&n.handlers.message.forEach((function(t){return t(e.data.message)}))},messageerror:function(e){"frame-broadcast"===e.data.type&&e.data.channel===n.name&&n.handlers.messageerror.forEach((function(t){return t(e.data.message)}))}},["message","messageerror"].forEach((function(e){window.addEventListener(e,n.mainHandler[e])})),this.broadcastHandler=this.broadcastHandler.bind(this),this.isTop&&window.addEventListener("message",this.broadcastHandler)}return a(e,[{key:"broadcastHandler",value:function(e){if("frame-broadcast-request"===e.data.type&&e.data.channel===this.name){window.postMessage({type:"frame-broadcast",channel:this.name,message:e.data.message},"*");for(var t=0;t<window.frames.length;t+=1){window.frames[t].postMessage({type:"frame-broadcast",channel:this.name,message:e.data.message},"*")}}}},{key:"postMessage",value:function(e){window.parent.postMessage({type:"frame-broadcast-request",channel:this.name,message:e},"*")}},{key:"close",value:function(){var e=this;this.handlers={},this.onMessage=null,["message","messageerror"].forEach((function(t){window.removeEventListener(t,e.mainHandler[t])})),this.isTop&&window.removeEventListener("message",this.broadcastHandler)}},{key:"addEventListener",value:function(e,t){this.handlers[e].push(t)}},{key:"removeEventListener",value:function(e,t){this.handlers[e]=this.handlers[e].filter((function(e){return e!==t}))}},{key:"onmessage",set:function(e){this.removeEventListener("message",e),"function"==typeof e?(this.addEventListener("message",e),this.onMessage=e):this.onMessage=null}}]),e}();t.default=r}])}));
//# sourceMappingURL=syncState.umd.js.map